# 機能定義（概要）

**システム名：iLスクエア予約システム**　　　　　　　　　　　　　　　　　　　　**2025年6月14日**

---

## PBI-001: ユーザー登録機能

### 機能概要
新規ユーザーがシステムを利用するためのアカウントを作成する機能

### 処理内容
1. **入力検証**
   - 必須項目（ユーザーID、氏名（姓・名）、メールアドレス、電話番号、パスワード）の確認
   - メールアドレス形式の検証（必須項目として実装済み）
   - パスワード強度の確認（Django標準バリデーション）
   
2. **重複チェック**
   - 既存ユーザーとのユーザーID重複確認
   
3. **データ保存**
   - カスタムユーザーモデルでの情報保存
   - パスワードはDjango標準でハッシュ化
   
4. **完了処理**
   - 登録完了メッセージの表示
   - ログイン画面への遷移

### 関連画面
- accounts/register.html: ユーザー登録画面

### 実装状況
✅ **実装完了** - メールアドレス必須化、バリデーション強化済み

---

## PBI-002: ログイン・ログアウト機能

### 機能概要
登録済みユーザーの認証とセッション管理を行う機能

### 処理内容
1. **ログイン処理**
   - ユーザーID・パスワードによる認証
   - Django標準認証システムの活用
   - マイページへの自動遷移
   
2. **ログアウト処理**
   - セッション情報の安全な削除
   - トップページへの遷移
   
3. **セッション管理**
   - Django標準セッション管理
   - 適切な認証必須画面の設定

### 関連画面
- accounts/login.html: ログイン画面
- base.html: ヘッダーのログアウトボタン

### 実装状況
✅ **実装完了** - セキュリティ強化、UX改善済み

---

## PBI-003: 3ステップ予約フロー機能

### 機能概要
直感的な3段階選択による予約申込機能（大幅改善実装済み）

### 処理内容

#### ステップ1: 日付選択
- 平日カレンダーからの利用日選択
- 利用可能日のみ選択可能
- 直感的なカレンダーインターフェース

#### ステップ2: スペース・開始時刻選択
- リストボックスによるスペース選択
- 選択したスペースの詳細情報表示
- JavaScript連携による動的な開始時刻テーブル表示
- 空き状況の○×表示

#### ステップ2.5: 終了時刻選択（新規実装）
- セレクトボックスでの終了時刻選択
- 利用時間と料金の自動計算・表示
- 選択内容確認表示

#### ステップ3: 予約確認
- 全選択内容の詳細確認
- 料金計算結果の表示
- 利用規約確認

#### ステップ4: 予約完了
- 予約データのデータベース保存
- 予約番号の自動生成
- 完了通知とマイページリンク

### 関連画面
- reservation/reserve_step1.html: 日付選択
- reservation/reserve_step2.html: スペース・時刻選択
- reservation/reserve_step2_5.html: 終了時刻選択
- reservation/reserve_step3.html: 予約確認
- reservation/reserve_complete.html: 予約完了

### 実装状況
✅ **実装完了** - 全面的な設計変更により使いやすさを大幅改善

---

## PBI-004: 予約履歴機能

### 機能概要
ユーザーの現在の予約と過去の利用履歴を表示する機能

### 処理内容
1. **現在の予約表示**
   - 確定済み予約の一覧表示
   - 予約詳細情報（日時、スペース、料金）
   - キャンセル機能（前日まで）
   
2. **利用履歴表示**
   - 過去の予約履歴
   - 利用状況（完了、キャンセル済み）
   
3. **操作機能**
   - 予約詳細表示
   - 予約キャンセル処理

### 関連画面
- reservation/reservations.html: 予約履歴画面
- reservation/reservation_detail.html: 予約詳細画面

### 実装状況
✅ **実装完了** - 金額表示統一、UI改善済み

---

## PBI-005: マイページ機能

### 機能概要
ユーザー専用ダッシュボードとして各機能へのアクセスを提供

### 処理内容
1. **ダッシュボード表示**
   - ユーザー名での個人化表示
   - 機能メニューのカード形式表示
   
2. **現在の予約表示**
   - 直近の予約状況
   - 予約詳細へのクイックアクセス
   
3. **ナビゲーション**
   - 新規予約、予約履歴、プロフィールへのリンク
   - お知らせ情報の表示

### 関連画面
- accounts/mypage.html: マイページ

### 実装状況
✅ **実装完了** - ナビゲーション簡素化、UX改善済み

---

## PBI-006: プロフィール管理機能

### 機能概要
ユーザー情報の確認・変更機能

### 処理内容
1. **情報表示**
   - 登録情報の確認表示
   - メールアドレス、電話番号、氏名の表示
   
2. **情報変更**
   - フォームによる情報更新
   - バリデーション付き入力チェック
   
3. **更新処理**
   - データベースへの安全な保存
   - 更新完了の確認表示

### 関連画面
- accounts/profile.html: プロフィール画面

### 実装状況
✅ **実装完了** - 登録日時表示削除、UI改善済み

---

## PBI-007: 決済情報管理機能

### 機能概要
予約に伴う決済情報の管理機能

### 処理内容
1. **決済方法**
   - 現金またはPayPay決済（クレジットカードから変更済み）
   - 料金自動計算（時間単位×単価）
   
2. **料金表示**
   - 整数表示での統一（小数点表示を修正済み）
   - 利用時間に応じた正確な計算
   
3. **決済記録**
   - 予約と連動した決済情報保存
   - 履歴での決済状況確認

### 関連モデル
- Payment: 決済情報管理

### 実装状況
✅ **実装完了** - 現金/PayPay対応、料金表示統一済み

---

## PBI-008: レスポンシブ対応機能

### 機能概要
マルチデバイス対応のレスポンシブデザイン実装

### 処理内容
1. **デバイス対応**
   - PC、タブレット、スマートフォン対応
   - ビューポート設定とメディアクエリ
   
2. **レイアウト調整**
   - 画面サイズに応じた要素配置
   - タッチ操作対応のボタンサイズ
   
3. **表示最適化**
   - 各デバイスでの読みやすさ確保
   - 操作しやすいインターフェース

### 関連ファイル
- static/css/style.css: メインスタイルシート

### 実装状況
✅ **実装完了** - 全画面でのマルチデバイス対応実装済み

---

## PBI-009: セキュリティ機能

### 機能概要
Webアプリケーションのセキュリティ対策実装

### 処理内容
1. **CSRF対策**
   - 全フォームでのCSRFトークン実装
   - Django標準保護機能の活用
   
2. **認証制御**
   - ログイン必須画面の適切な設定
   - セッション管理の安全性確保
   
3. **入力検証**
   - フォームバリデーションの徹底
   - SQLインジェクション対策（Django ORM）

### 実装状況
✅ **実装完了** - Django標準セキュリティ機能の完全実装

---

## 実装時の主要改善点

### 1. 予約フロー大幅改善
**変更前**: 複雑なテーブル型一括選択
**変更後**: 3ステップ段階的選択（日付→スペース→時刻）

### 2. UI/UX統一性向上
**変更前**: 画面間での表示フォーマット不統一
**変更後**: 進行状況、金額表示、ボタンデザインの統一

### 3. ナビゲーション簡素化
**変更前**: 複数の不要画面による複雑性
**変更後**: 核心機能に集約したシンプルな構成

### 4. 技術的改善
- 金額の整数表示統一
- JavaScript連携による動的UI
- セッション管理の信頼性向上
- レスポンシブデザインの完全実装

---

## 改訂履歴

| 版 | 改訂日 | 改訂者 | 改訂内容 |
|----|--------|--------|----------|
| 1.0 | 2025/06/14 | 田中一郎 | 新規作成 |
| 2.0 | 2025/06/14 | 田中一郎 | 実装完了版への全面改訂 |

---

**作成者：Aチーム**　　　　　　　　　　　　　　　　　　　　　　　　　　**承認者：田中一郎**